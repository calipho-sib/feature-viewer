/*! feature-viewer 2017-12-30 */
var FeatureViewer=function(){function a(a,b,c){function d(a,b){R!=={}&&d3.select(R.id).style("fill",R.originalColor),"path"!==b.type&&"line"!==b.type&&(R={id:a,originalColor:d3.select(a).style("fill")||b.color},d3.select(a).style("fill","orangered"))}function e(a,b){for(var c=a-110,d="",e=0;e<b.length;e++)if(W(b[e].x)<c&&W(b[e+1].x)>c){d=c-W(b[e].x)<W(b[e+1].x)-c?b[e]:b[e+1];break}return d}function f(a){return W(a.x===a.y?a.x-.4:a.x)}function g(a){return a.x===a.y?W(a.x+.4)-W(a.x-.4)<2?2:W(a.x+.4)-W(a.x-.4):W(a.y)-W(a.x)}function h(a){var b=[];return a.forEach(function(a){if(b===[])b.push(a.y),a.level=0;else{for(var c=!1,d=0;d<b.length;d++)if(a.x>b[d]){c=!0,a.level=d,b[d]=a.y;break}c===!1&&(b.push(a.y),a.level=b.length-1)}}),b.length}function i(a,b,c){if("number"!=typeof a||-1>a||a>1||"string"!=typeof b||"r"!=b[0]&&"#"!=b[0]||"string"!=typeof c&&"undefined"!=typeof c)return null;this.sbcRip||(this.sbcRip=function(a){var b=a.length,c=new Object;if(b>9){if(a=a.split(","),a.length<3||a.length>4)return null;c[0]=d(a[0].slice(4)),c[1]=d(a[1]),c[2]=d(a[2]),c[3]=a[3]?parseFloat(a[3]):-1}else{if(8==b||6==b||4>b)return null;6>b&&(a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]+(b>4?a[4]+""+a[4]:"")),a=d(a.slice(1),16),c[0]=a>>16&255,c[1]=a>>8&255,c[2]=255&a,c[3]=9==b||5==b?e((a>>24&255)/255*1e4)/1e4:-1}return c});var d=parseInt,e=Math.round,f=b.length>9,f="string"==typeof c?c.length>9?!0:"c"==c?!f:!1:f,g=0>a,a=g?-1*a:a,c=c&&"c"!=c?c:g?"#000000":"#FFFFFF",h=sbcRip(b),i=sbcRip(c);return h&&i?f?"rgb("+e((i[0]-h[0])*a+h[0])+","+e((i[1]-h[1])*a+h[1])+","+e((i[2]-h[2])*a+h[2])+(h[3]<0&&i[3]<0?")":","+(h[3]>-1&&i[3]>-1?e(1e4*((i[3]-h[3])*a+h[3]))/1e4:i[3]<0?h[3]:i[3])+")"):"#"+(4294967296+16777216*(h[3]>-1&&i[3]>-1?e(255*((i[3]-h[3])*a+h[3])):i[3]>-1?e(255*i[3]):h[3]>-1?e(255*h[3]):255)+65536*e((i[0]-h[0])*a+h[0])+256*e((i[1]-h[1])*a+h[1])+e((i[2]-h[2])*a+h[2])).toString(16).slice(h[3]>-1||i[3]>-1?1:3):null}function j(a){G.append("g").attr("class","x axis Xaxis").attr("transform","translate(0,"+(a+20)+")").call(ea)}function k(a){G.selectAll(".Xaxis").attr("transform","translate(0,"+(a+20)+")")}function l(a){F.attr("height",a+60+"px"),F.select("clippath rect").attr("height",a+60+"px")}function m(){H=F.append("g").attr("class","pro axis").attr("transform","translate(0,"+T.top+")"),n()}function n(){I=H.selectAll(".yaxis").data(K).enter().append("g"),I.append("polygon").attr("class",function(a){return a.filter?a.filter.split(" ").join("_")+"Arrow":"Arrow"}).style("stroke","").style("fill","#DFD5D3").attr("points",function(a){return T.left-105+","+(a.y-3)+", "+(T.left-105)+","+(a.y+12)+", "+(T.left-15)+","+(a.y+12)+", "+(T.left-7)+","+(a.y+4.5)+", "+(T.left-15)+","+(a.y-3)}),I.append("text").attr("class","yaxis").attr("text-anchor","start").attr("x",function(){return T.left-102}).attr("y",function(a){return a.y+8}).text(function(a){return a.title})}function o(a){a.on("mousedown",function(){brush_elm=F.select(".brush").node(),new_click_event=new Event("mousedown"),new_click_event.pageX=d3.event.pageX,new_click_event.clientX=d3.event.clientX,new_click_event.pageY=d3.event.pageY,new_click_event.clientY=d3.event.clientY,brush_elm&&brush_elm.dispatchEvent(new_click_event)})}function p(){G.append("g").attr("class","brush").call(ja).selectAll("rect").attr("height",L+50)}function q(){if(d3.select(b).selectAll("div.selectedRect").remove(),0!==Object.keys(R).length&&R.constructor===Object){if(d3.select(R.id).style("fill",R.originalColor),R={},CustomEvent){var c=new CustomEvent(x.events.FEATURE_DESELECTED_EVENT,{detail:{info:"feature-deselected"}});y.dispatchEvent(c)}else console.warn("CustomEvent is not defined....");x.trigger&&x.trigger(x.events.FEATURE_DESELECTED_EVENT,{info:"feature-deselected"})}var d=ja.extent(),e=Math.abs(d[0]-d[1]);if(d[0]<d[1])var f=parseInt(d[0]-1),g=parseInt(d[1]+1);else var f=parseInt(d[1]+1),g=parseInt(d[0]-1);var h=Z(e);if(!ja.empty()&&e>P){Q.length=e;var i=(B/e).toFixed(1);$(b+" .zoomUnit").text(i.toString()),D.showSequence&&!A&&h&&G.selectAll(".AA").empty()&&(Q={length:e,start:f,end:g},N=f,G.selectAll(".sequenceLine").remove(),ha.sequence(a.substring(f-1,g),20,N-1)),W.domain(d),X.range(d);var j=N?N:E.start;t(C,j),u(),CustomEvent&&y.dispatchEvent(new CustomEvent(x.events.ZOOM_EVENT,{detail:{start:f,end:g,zoom:i}})),x.trigger&&x.trigger(x.events.ZOOM_EVENT,{start:f,end:g,zoom:i}),d3.select(b).selectAll(".brush").call(ja.clear())}else d3.select(b).selectAll(".brush").call(ja.clear())}function r(){U=$(b).width()-T.left-T.right-17,d3.select(b+" svg").attr("width",U+T.left+T.right),d3.select(b+" #clip>rect").attr("width",U),D.brushActive&&d3.select(b+" .background").attr("width",U),d3.select(b).selectAll(".brush").call(ja.clear());var c=Z(Q.length);D.showSequence&&!A&&(c!==!1||G.selectAll(".AA").empty()?c===!0&&G.selectAll(".AA").empty()&&(G.selectAll(".sequenceLine").remove(),ha.sequence(a.substring(Q.start-1,Q.end),20,Q.start-1)):(G.selectAll(".seqGroup").remove(),ha.sequenceLine())),W.range([5,U-5]),X.domain([0,U]),t(C,Q.start),u()}function s(){$(".zoomUnit").text("1"),W.domain([E.start,E.end]),X.range([E.start,E.end]);var c=Z(E.end-E.start);D.showSequence&&!A&&(c!==!1||G.selectAll(".AA").empty()?Q.length===B||c!==!0||G.selectAll(".AA").empty()||(G.selectAll(".seqGroup").remove(),ha.sequence(a.substring(E.start-1,E.end),20,E.start)):(G.selectAll(".seqGroup").remove(),ha.sequenceLine())),Q={length:E.end-E.start,start:E.start,end:E.end},N=0,t(C,E.start),u(),CustomEvent&&y.dispatchEvent(new CustomEvent(x.events.ZOOM_EVENT,{detail:{start:1,end:a.length,zoom:1}})),x.trigger&&x.trigger(x.events.ZOOM_EVENT,{start:1,end:a.length,zoom:1}),d3.select(b).selectAll(".brush").call(ja.clear())}function t(a,b){a.forEach(function(a){"rect"===a.type?ia.rectangle(a):"multipleRect"===a.type?ia.multiRec(a):"unique"===a.type?ia.unique(a):"path"===a.type?ia.path(a):"line"===a.type?ia.line(a):"text"===a.type&&ia.text(a,b)})}function u(){G.transition().duration(500).select(".x.axis").call(ea)}function v(){var a=d3.select(".chart").append("div").attr("class","Vline").style("position","absolute").style("z-index","19").style("width","1px").style("height",L+50+"px").style("top","30px").style("background","#000");d3.select(".chart").on("mousemove.Vline",function(){mousex=d3.mouse(this)[0]-2,a.style("left",mousex+"px")})}function w(b,c){if("undefined"==typeof c)var c={showAxis:!1,showSequence:!1,brushActive:!1,verticalLine:!1,toolbar:!1,bubbleHelp:!1,unit:"units",zoomMax:50};if($.fn.popover||(c.bubbleHelp=!1,console.warn("The bubble help requires tooltip and popover bootstrap js libraries. The feature viewer will continue to work, but without the info bubble")),c.zoomMax&&(P=c.zoomMax),c.unit||(c.unit="units"),c.animation&&(S=c.animation),c.toolbar===!0){var d=$(b+" .svgHeader").length?d3.select(b+" .svgHeader"):d3.select(b).append("div").attr("class","svgHeader");if(!$(b+" .header-position").length){var e=d.append("div").attr("class","header-position").style("display","inline-block").style("margin","15px 10px 0px").style("padding","0px").style("line-height","32px");e.append("div").attr("class","position-label").style("padding","0px 5px").style("display","inline-block").style("padding","0px").style("font-weight","700").text("Position  :  "),e.append("div").style("display","inline-block").style("padding","0px").style("padding-left","5px").append("div").style("min-width","50px").attr("id","zoomPosition").text("0")}if(!$(b+" .header-zoom").length){var f=d.append("div").attr("class","header-zoom").style("display","inline-block").style("margin","15px 0px 0px").style("padding","0px").style("line-height","32px");f.append("div").attr("class","zoom-label").style("padding","0px 5px").style("display","inline-block").style("padding","0px").style("font-weight","700").text("Zoom : "),f.append("div").style("display","inline-block").style("padding","0px").append("div").style("min-width","50px").style("padding-left","5px").append("span").text("x ").append("span").attr("class","zoomUnit").text("1")}var f=$(b+" .header-zoom").length?d3.select(b+" .header-zoom"):d;if(c.bubbleHelp===!0&&!$(b+" .header-help").length){var g="<div><strong>To zoom in :</strong> Left click to select area of interest</div><div><strong>To zoom out :</strong> Right click to reset the scale</div><div><strong>Zoom max  :</strong> Limited to <strong>"+P.toString()+" "+c.unit+"</strong></div>",h=f.append("div").style("display","inline-block").style("margin","0px").style("margin-right","5px").style("padding","0px"),i=h.append("a").attr("type","button").attr("class","header-help").attr("data-toggle","popover").attr("data-placement","auto left").attr("title","Help").attr("data-content",g).style("font-size","14px");i.append("span").attr("class","label label-as-badge label-info").style("font-weight","500").style("border-radius","3px").style("box-shadow","inset 0px 0px 4px rgba(0,0,0,0.10)").style("color","#fff").html("<span class='state'>Show</span> help"),$(function(){$('[data-toggle="popover"]').popover({html:!0}),$(b+" .header-help").on("hide.bs.popover",function(){$(this).find(".state").text("Show")}),$(b+" .header-help").on("show.bs.popover",function(){$(this).find(".state").text("Hide")})})}}F=d3.select(b).append("svg").attr("width",U+T.left+T.right).attr("height",V+T.top+T.bottom).style("z-index","2").on("contextmenu",function(a,b){d3.event.preventDefault(),s()}),y=z.getElementsByTagName("svg")[0],G=F.append("g").attr("transform","translate("+T.left+","+T.top+")");var k=G.append("defs");k.append("clipPath").attr("id","clip").append("rect").attr("width",U).attr("height",V);var n=k.append("filter").attr("id","dropshadow").attr("height","200%");n.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3).attr("result","blur"),n.append("feOffset").attr("in","blur").attr("dx",-2).attr("dy",2).attr("result","offsetBlur");var o=n.append("feMerge");o.append("feMergeNode").attr("in","offsetBlur"),o.append("feMergeNode").attr("in","SourceGraphic"),G.on("mousemove",function(){var d=D.brushActive?d3.mouse(d3.select(".background").node()):d3.mouse(G.node()),e=Math.round(X(d[0]));c.positionWithoutLetter||(e+=a[e-1]||""),$(b+" #zoomPosition").text(e)}),"undefined"!=typeof c.dottedSequence&&(D.dottedSequence=c.dottedSequence),c.showSequence&&!A&&(D.showSequence=!0,Z(E.end-E.start)?ha.sequence(a.substring(E.start-1,E.end),L,E.start):ha.sequenceLine(),C.push({data:a,name:"Sequence",className:"AA",color:"black",type:"text"}),K.push({title:"Sequence",y:L-8})),c.showAxis&&j(L),m(),c.brushActive&&(D.brushActive=!0,O=!0,p()),c.verticalLine&&(D.verticalLine=!0,v()),l(L)}var x=this;this.events={FEATURE_SELECTED_EVENT:"feature-viewer-position-selected",FEATURE_DESELECTED_EVENT:"feature-viewer-position-deselected",ZOOM_EVENT:"feature-viewer-zoom-altered"};var y,b=b,z=document.getElementById(b.substring(1)),a=a,A=Number.isInteger(a)?a:null,B=A|a.length,C=[],D={showSequence:!1,brushActive:!1,verticalLine:!1,dottedSequence:!0},E={start:1,end:B};c&&c.offset&&(E=c.offset,E.start<1&&(E.start=1,console.warn("WARNING ! offset.start should be > 0. Thus, it has been reset to 1.")));var F,G,H,I,J=0,K=[],L=20,M=0,N=0,O=!1,P=50,Q={length:E.end-E.start,start:E.start,end:E.end},R={},S=!0;d3.select(b).style("position","relative").style("padding","0px").style("z-index","2");var T={top:10,right:20,bottom:20,left:110},U=$(b).width()-T.left-T.right-17,V=600-T.top-T.bottom,W=d3.scale.linear().domain([E.start,E.end]).range([5,U-5]),X=d3.scale.linear().domain([0,U]).range([E.start,E.end]);d3.helper={},d3.helper.tooltip=function(a){function f(c){c.on("mouseover.tooltip",function(c,d){d3.select("body").selectAll("div.tooltip").remove();var f=d3.mouse(i),h=f[0]>U;if(h?g=d3.select(b).append("div").attr("class","tooltip3"):(g=d3.select(b).append("div").attr("class","tooltip2"),g.style({left:f[0]-15+"px"})),g.style({bottom:i.offsetHeight-f[1]+16+"px","background-color":"#eee",width:"auto","max-width":"170px",height:"auto","max-height":"68px",padding:"5px",font:"10px sans-serif","text-align":"center",position:"absolute","z-index":45,"box-shadow":"0 1px 2px 0 #656565"}),"path"===a.type){var k='<p style="margin:2px;font-weight:700;color:'+j+'">'+c[0].x+"&#x256d;&#x256e;"+c[1].x+"</p>";if(c.description)var l='<p style="margin:2px;color:'+j+';font-size:9px">'+c.description+"</p>";else var l=""}else if("line"===a.type){var m=e(f[0],c);if(m.description)var k='<p style="margin:2px;font-weight:700;color:'+j+'">'+m.x+" : <span> "+m.y+"</span></p>",l='<p style="margin:2px;color:'+j+';font-size:9px">'+m.description+"</p>";else var k='<p style="margin:2px;color:'+j+'">position : <span id="tLineX">'+m.x+"</span></p>",l='<p style="margin:2px;color:'+j+'">count : <span id="tLineC">'+m.y+"</span></p>"}else if("unique"===a.type||c.x===c.y){var k='<p style="margin:2px;font-weight:700;color:'+j+'">'+c.x+"</p>";if(c.description)var l='<p style="margin:2px;color:'+j+';font-size:9px">'+c.description+"</p>";else var l=""}else{var k='<p style="margin:2px;font-weight:700;color:'+j+'">'+c.x+" - "+c.y+"</p>";if(c.description)var l='<p style="margin:2px;color:'+j+';font-size:9px">'+c.description+"</p>";else var l=""}g.html(k+l),h&&g.style({left:f[0]+10-g.node().getBoundingClientRect().width+"px"})}).on("mousemove.tooltip",function(b,c){if("line"===a.type){var d=d3.mouse(i),f=e(d[0],b);if(f.description)var h='<p style="margin:2px;color:'+j+'">'+f.x+" : <span> "+f.y+"</span></p>",k='<p style="margin:2px;color:'+j+';font-size:9px">'+f.description+"</p>";else var h='<p style="margin:2px;color:'+j+'">position : <span id="tLineX">'+f.x+"</span></p>",k='<p style="margin:2px;color:'+j+'">count : <span id="tLineC">'+f.y+"</span></p>";g.html(h+k)}if(void 0!==g){var d=d3.mouse(i),l=d[0]>U;l?(g.attr("class","tooltip3"),g.style({left:d[0]+10-g.node().getBoundingClientRect().width+"px",bottom:i.offsetHeight-d[1]+16+"px"})):(g.attr("class","tooltip2"),g.style({left:d[0]-15+"px",bottom:i.offsetHeight-d[1]+16+"px"}))}}).on("mouseout.tooltip",function(a,b){g.remove()}).on("click",function(c,f){var g,j,k,l,m;if("text"===this.nodeName){var n="#"+this.previousSibling.id;"#"!==n.nodeName&&d(n,a)}else d(this,a);var o=D.brushActive?d3.select(".background").attr("width"):G.node().getBBox().width;if(d3.select("body").selectAll("div.selectedRect").remove(),h=d3.select(b).append("div").attr("class","selectedRect"),"path"===a.type)g=c[0].x,j=c[1].x;else if("line"===a.type){var p=d3.mouse(i);m=e(p[0],c),g=m.x-.5,j=m.x+.5}else"unique"===a.type||c.x===c.y?(g=c.x-.4,j=c.y+.4):(g=c.x,j=c.y);if(W(g)<0&&W(j)>o?(k=T.left,l=parseInt(o)+5):W(g)<0?(k=T.left,l=W(j)):W(j)>o?(k=W(g)+T.left,l=parseInt(o)-W(g),l+=5):(k=W(g)+T.left,l=W(j)-W(g)),h.style({left:k+"px",top:$(b+" .svgHeader").length?"60px":"10px","background-color":"rgba(0, 0, 0, 0.2)",width:l+"px",height:L+50+"px",position:"absolute","z-index":-1,"box-shadow":"0 1px 2px 0 #656565"}),CustomEvent){var q=new CustomEvent(x.events.FEATURE_SELECTED_EVENT,{detail:{start:"path"===a.type?c[0].x:"line"===a.type?m.x:c.x,end:"path"===a.type?c[1].x:"line"===a.type?m.y:c.y,id:"path"===a.type?c[0].id:"line"===a.type?m.id:c.id,description:"path"===a.type?c[0].description:"line"===a.type?m.description:c.description}});y.dispatchEvent(q)}else console.warn("CustomEvent is not defined....");x.trigger&&x.trigger(x.events.FEATURE_SELECTED_EVENT,{start:"path"===a.type?c[0].x:"line"===a.type?m.x:c.x,end:"path"===a.type?c[1].x:"line"===a.type?m.y:c.y,id:"path"===a.type?c[0].id:"line"===a.type?m.id:c.id,description:"path"===a.type?c[0].description:"line"===a.type?m.description:c.description})})}var g,h,i=d3.select(b).node(),j=c.tooltipColor?c.tooltipColor:"orangered";return f.attr=function(a){return arguments.length?(attrs=a,this):attrs},f.style=function(a){return arguments.length?(styles=a,this):styles},f};var Y=function(a){return W(a.x)},Z=function(a){return U/a>5},_=function(a){return W(a.y)-W(a.x)};this.onFeatureSelected=function(a){y.addEventListener(x.events.FEATURE_SELECTED_EVENT,a)},this.onFeatureDeselected=function(a){y.addEventListener(x.events.FEATURE_DESELECTED_EVENT,a)},this.onZoom=function(a){y.addEventListener(x.events.ZOOM_EVENT,a)};var aa=d3.svg.line().interpolate("step-before").x(function(a){return W(a.x)}).y(function(a){return 10*-a.y+J}),ba=d3.svg.line().x(function(a){return W(a.x)}).y(function(a){return 10*ca(-a.y)+J}),ca=d3.scale.linear().domain([0,-30]).range([0,-20]),da=d3.svg.line().interpolate("linear").x(function(a){return W(a.x)}).y(function(a){return a.y+6}),ea=d3.svg.axis().scale(W).tickFormat(d3.format("d")).orient("bottom"),fa=d3.scale.ordinal().domain([0,K.length]).rangeRoundBands([0,500],.1),ga=(d3.svg.axis().scale(fa).tickValues(K).tickFormat(function(a){return a}).orient("left"),{path:function(a){a.data.sort(function(a,b){return a.x-b.x});var b=h(a.data);a.data=a.data.map(function(a){return[{x:a.x,y:0,id:a.id,description:a.description,color:a.color},{x:a.y,y:a.level+1,id:a.id},{x:a.y,y:0,id:a.id}]}),J=10*b+5,a.height=10*b+5},line:function(a){a.height||(a.height=10);var b=parseInt(a.height),c=0;for(var d in a.data){a.data[d].sort(function(a,b){return a.x-b.x}),0!==a.data[d][0].y&&a.data[d].unshift({x:a.data[d][0].x-1,y:0}),0!==a.data[d][a.data[d].length-1].y&&a.data[d].push({x:a.data[d][a.data[d].length-1].x+1,y:0});var e=Math.max.apply(Math,a.data[d].map(function(a){return Math.abs(a.y)}));c=e>c?e:c,a.data[d]=[a.data[d].map(function(a){return{x:a.x,y:a.y,id:a.id,description:a.description}})]}ca.range([0,-b]).domain([0,-c]),J=10*b+5,a.level=c,a.shift=10*b+5},multipleRect:function(a){a.data.sort(function(a,b){return a.x-b.x}),M=h(a.data),J=10*M+5}}),ha={typeIdentifier:function(a){if("rect"===a.type)ga.multipleRect(a),K.push({title:a.name,y:L,filter:a.filter}),ha.rectangle(a,L);else if("text"===a.type)ha.sequence(a.data,L),K.push({title:a.name,y:L,filter:a.filter}),W.range([5,U-5]);else if("unique"===a.type)ha.unique(a,L),K.push({title:a.name,y:L,filter:a.filter});else if("multipleRect"===a.type)ga.multipleRect(a),ha.multipleRect(a,L,M),K.push({title:a.name,y:L,filter:a.filter}),L+=10*(M-1);else if("path"===a.type)ga.path(a),ha.path(a,L),L+=J,K.push({title:a.name,y:L-10,filter:a.filter});else if("line"===a.type){Array.isArray(a.data[0])||(a.data=[a.data]),Array.isArray(a.color)||(a.color=[a.color]);var b=!1;a.data.forEach(function(a){a.filter(function(a){return a.y<0}).length&&(b=!0)}),ga.line(a),ha.line(a,L),L+=J,K.push({title:a.name,y:L-10,filter:a.filter}),L+=b?J-5:0}},sequence:function(a,b,c){if(!c)var c=0;G.append("g").attr("class","seqGroup").selectAll(".AA").data(a).enter().append("text").attr("clip-path","url(#clip)").attr("class","AA").attr("text-anchor","middle").attr("x",function(a,b){return W.range([5,U-5])(b+c)}).attr("y",b).attr("font-size","10px").attr("font-family","monospace").text(function(a,b){return a})},sequenceLine:function(){if(D.dottedSequence){var a=G.selectAll(".sequenceLine").data([[{x:1,y:12},{x:B,y:12}]]).enter().append("path").attr("clip-path","url(#clip)").attr("d",da).attr("class","sequenceLine").style("z-index","0").style("stroke","black").style("stroke-dasharray","1,3").style("stroke-width","1px").style("stroke-opacity",0);a.transition().duration(500).style("stroke-opacity",1)}},rectangle:function(a,b){a.height||(a.height=12);for(var c=a.height,d=c+c/3,e=c/2-6,h=G.append("g").attr("class","rectangle").attr("clip-path","url(#clip)").attr("transform","translate(0,"+b+")"),i=[],j=0;M>j;j++)i.push([{x:1,y:j*d+e},{x:B,y:j*d+e}]);h.selectAll(".line"+a.className).data(i).enter().append("path").attr("d",da).attr("class",function(){return"line"+a.className}).style("z-index","0").style("stroke",a.color).style("stroke-width","1px");var k=h.selectAll("."+a.className+"Group").data(a.data).enter().append("g").attr("class",a.className+"Group").attr("transform",function(a){return"translate("+f(a)+",0)"});k.append("rect").attr("class","element "+a.className).attr("id",function(a){return"f"+a.id}).attr("y",function(a){return a.level*d}).attr("width",g).attr("height",c).style("fill",function(b){return b.color||a.color}).style("z-index","13").call(d3.helper.tooltip(a)),k.append("text").attr("class","element "+a.className+"Text").attr("y",function(a){return a.level*d+c/2}).attr("dy","0.35em").style("font-size","10px").text(function(a){return a.description}).style("fill","black").style("z-index","15").style("visibility",function(a){return a.description&&W(a.y)-W(a.x)>8*a.description.length&&c>11?"visible":"hidden"}).call(d3.helper.tooltip(a)),o(k);var l=c>12?c-6:0;L+=2>M?l:(M-1)*d+l},unique:function(a,b){var c=G.append("g").attr("class","uniquePosition").attr("transform","translate(0,"+b+")"),d=[];d.push([{x:1,y:0},{x:B,y:0}]),c.selectAll(".line"+a.className).data(d).enter().append("path").attr("clip-path","url(#clip)").attr("d",da).attr("class","line"+a.className).style("z-index","0").style("stroke",a.color).style("stroke-width","1px"),c.selectAll("."+a.className).data(a.data).enter().append("rect").attr("clip-path","url(#clip)").attr("class","element "+a.className).attr("id",function(a){return"f"+a.id}).attr("x",function(a){return W(a.x-.4)}).attr("width",function(a){return W(a.x+.4)-W(a.x-.4)<2?2:W(a.x+.4)-W(a.x-.4)}).attr("height",12).style("fill",function(b){return b.color||a.color}).style("z-index","3").call(d3.helper.tooltip(a)),o(c)},path:function(a,b){var c=G.append("g").attr("class","pathing").attr("transform","translate(0,"+b+")"),d=[];d.push([{x:1,y:0},{x:B,y:0}]),c.selectAll(".line"+a.className).data(d).enter().append("path").attr("clip-path","url(#clip)").attr("d",aa).attr("class","line"+a.className).style("z-index","0").style("stroke",a.color).style("stroke-width","1px"),c.selectAll("."+a.className).data(a.data).enter().append("path").attr("clip-path","url(#clip)").attr("class","element "+a.className).attr("id",function(a){return"f"+a[0].id}).attr("d",aa).style("fill","none").style("stroke",function(b){return b[0].color||a.color}).style("z-index","3").style("stroke-width","2px").call(d3.helper.tooltip(a)),o(c)},line:function(a,b){a.interpolation||(a.interpolation="monotone"),void 0===a.fill&&(a.fill=!0);var c=G.append("g").attr("class","lining").attr("transform","translate(0,"+b+")"),d=[];d.push([{x:1,y:0},{x:B,y:0}]),c.selectAll(".line"+a.className).data(d).enter().append("path").attr("clip-path","url(#clip)").attr("d",aa).attr("class","line"+a.className).style("z-index","0").style("stroke","black").style("stroke-width","1px"),a.data.forEach(function(b,d,e){c.selectAll("."+a.className+d).data(b).enter().append("path").attr("clip-path","url(#clip)").attr("class","element "+a.className+" "+a.className+d).attr("d",ba.interpolate(a.interpolation)).style("fill",a.fill?i(.6,a.color[d])||i(.6,"#000"):"none").style("stroke",a.color[d]||"#000").style("z-index","3").style("stroke-width","2px").call(d3.helper.tooltip(a))}),o(c)},multipleRect:function(a,b,c){for(var d=8,e=10,f=G.append("g").attr("class","multipleRects").attr("transform","translate(0,"+b+")"),g=0;c>g;g++)f.append("path").attr("d",da([{x:1,y:g*e-2},{x:B,y:g*e-2}])).attr("class",function(){return"line"+a.className}).style("z-index","0").style("stroke",a.color).style("stroke-width","1px");f.selectAll("."+a.className).data(a.data).enter().append("rect").attr("clip-path","url(#clip)").attr("class","element "+a.className).attr("id",function(a){return"f"+a.id}).attr("x",Y).attr("y",function(a){return a.level*e}).attr("width",_).attr("height",d).style("fill",function(b){return b.color||a.color}).style("z-index","13").call(d3.helper.tooltip(a)),o(f)}};this.showFilteredFeature=function(a,b,c){var d=(H.selectAll("."+a+"Arrow"),T.left-105),e=T.left-7,f=F.append("linearGradient").attr("y1","0").attr("y2","0").attr("x1",d).attr("x2",e).attr("id","gradient").attr("spreadMethod","pad").attr("gradientUnits","userSpaceOnUse");f.append("stop").attr("offset","0.3").attr("stop-color","#DFD5D3").attr("stop-opacity",1);var g=f.append("stop").attr("offset","1").attr("stop-opacity",1).attr("stop-color","#DFD5D3");g.attr("stop-color",b);var h="url(#gradient)",i="url(#dropshadow)";c&&(h="url("+c+"#gradient)",i="url("+c+"#dropshadow)");var j=H.selectAll("."+a+"Arrow").style("fill",h).style("stroke","").attr("filter",i);j.attr("points",function(a){return T.left-105+","+(a.y-3)+", "+(T.left-105)+","+(a.y+12)+", "+(T.left-10)+","+(a.y+12)+", "+(T.left-2)+","+(a.y+4.5)+", "+(T.left-10)+","+(a.y-3)})},this.hideFilteredFeature=function(a){H.selectAll("."+a+"Arrow").style("fill","rgba(95,46,38,0.2)").attr("filter","").attr("points",function(a){return T.left-105+","+(a.y-3)+", "+(T.left-105)+","+(a.y+12)+", "+(T.left-15)+","+(a.y+12)+", "+(T.left-7)+","+(a.y+4.5)+", "+(T.left-15)+","+(a.y-3)})};var ia={rectangle:function(a){G.selectAll(".line"+a.className).attr("d",da.x(function(a){return W(a.x)}));S?(transit1=G.selectAll("."+a.className+"Group").transition().duration(500),transit2=G.selectAll("."+a.className).transition().duration(500)):(transit1=G.selectAll("."+a.className+"Group"),transit2=G.selectAll("."+a.className)),transit1.attr("transform",function(a){return"translate("+f(a)+",0)"}),transit2.attr("width",g),G.selectAll("."+a.className+"Text").style("visibility",function(b){return b.description&&W(b.y)-W(b.x)>8*b.description.length&&a.height>11?"visible":"hidden"})},multiRec:function(a){G.selectAll("."+a.className).attr("x",function(a){return W(a.x)}).attr("width",function(a){return W(a.y)-W(a.x)})},unique:function(a){G.selectAll(".line"+a.className).attr("d",da.x(function(a){return W(a.x)}));var b;b=S?G.selectAll("."+a.className).transition().duration(500):G.selectAll("."+a.className),b.attr("x",function(a){return W(a.x-.4)}).attr("width",function(a){return W(a.x+.4)-W(a.x-.4)<2?2:W(a.x+.4)-W(a.x-.4)})},path:function(a){G.selectAll(".line"+a.className).attr("d",aa.x(function(a){return W(a.x)}).y(function(b){return 10*-b.y+a.height}));var b;b=S?G.selectAll("."+a.className).transition().duration(500):G.selectAll("."+a.className),b.attr("d",aa.y(function(b){return 10*-b.y+a.height}))},line:function(a){ca.range([0,-a.height]).domain([0,-a.level]),G.selectAll(".line"+a.className).attr("d",ba.y(function(b){return 10*ca(-b.y)+a.shift}));var b;b=S?G.selectAll("."+a.className).transition().duration(500):G.selectAll("."+a.className),b.attr("d",ba.y(function(b){return 10*ca(-b.y)+a.shift}).interpolate(a.interpolation))},text:function(a,b){var c;c=S?G.selectAll("."+a.className).transition().duration(500):G.selectAll("."+a.className),c.attr("x",function(a,c){return W(c+b)})}},ja=d3.svg.brush().x(W).on("brushend",q);this.zoom=function(a,b){var c=Q.start<a&&Q.end>b;c||G.selectAll(".seqGroup").remove(),ja.extent([a,b]),q()},this.resetZoom=function(a,b){s()};var ka=function(){r()};$(window).on("resize",ka),this.addRectSelection=function(a){var c,e,f,g,h=d3.select(a),i=h.data(),j=D.brushActive?d3.select(".background").attr("width"):G.node().getBBox().width;d3.select("body").selectAll("div.selectedRect").remove();var k={type:h[0][0].tagName,color:h.style("fill")};d(a,k);var l=d3.select(b).append("div").attr("class","selectedRect");3===i[0].length?(c=i[0][0].x,e=i[0][1].x):i[0].x===i[0].y?(c=i[0].x-.5,e=i[0].y+.5):(c=i[0].x,e=i[0].y),W(c)<0?(f=T.left,g=W(e)):W(e)>j?(f=W(c)+T.left,g=j-W(c)):(f=W(c)+T.left,g=W(e)-W(c)),l.style({left:f+"px",top:"60px","background-color":"rgba(0, 0, 0, 0.2)",width:g+"px",height:L+50+"px",position:"absolute","z-index":-1,"box-shadow":"0 1px 2px 0 #656565"})},w(b,c),this.addFeature=function(a){L+=20,C.push(a),ha.typeIdentifier(a),n(),k(L),l(L),D.brushActive&&G.selectAll(".brush rect").attr("height",L+50),D.verticalLine&&d3.selectAll(".Vline").style("height",L+50+"px"),d3.selectAll(".element")[0].length>1500&&(S=!1)},this.isFeature=function(a,b){b||(b=id);for(var c=0;c<C.length;c++)if(C[c][b]===a)return!0;return!1},this.clearInstance=function(){$(window).off("resize",ka),F=null,y=null,G=null,I=null,H=null,C=null,sbcRip=null,d3.helper={}}}return a}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=FeatureViewer);